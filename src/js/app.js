function MainController(e,t,n,o,r,a){function u(){if(m.data.pullRequests){var e=_.chain(m.data.pullRequests).groupBy(function(e){return e.repository.name}).value();m.data.grouped=e}}function i(){return e(function(e,t){try{var n=JSON.parse(localStorage._github_pullrequests);n||t(),m.config.username=n.username,m.config.token=n.token,m.config.ok=!0,e(m.config)}catch(o){t()}})}function c(){i().then(l,s)}function s(){m.config.ok=!1,chrome&&chrome.browserAction&&chrome.browserAction.setBadgeText({text:"?"})}function l(e){var t="https://api.github.com/search/issues?q=assignee:"+e.username+"+state:open+type:pr";r.defaults.headers.common.Authorization="TOKEN "+e.token,r.get(t).then(function(e){count=e.data.total_count,chrome&&chrome.browserAction?chrome.browserAction.setBadgeText({text:count.toString()}):m.count=count,m.data.pullRequests=e.data.items.map(a.load)}),g&&n.cancel(g),g=n(function(){l(m.config)},3e5)}var m=this;m.count=0,m.data={pullRequests:[],grouped:[]},m.openPull=function(e){chrome&&chrome.tabs?chrome.tabs.create({url:e.url}):o.location=e.url},t.$watch(function(){return m.data.pullRequests},function(){u()},!0),m.config={ok:!1,username:"",token:""};var g;c(),chrome&&chrome.runtime&&chrome.runtime.onMessage&&chrome.runtime.onMessage.addListener(function(e,t,o){e.config&&(localStorage._github_pullrequests=JSON.stringify(e.config),n(function(){c()}))})}function Options(e,t){function n(){try{var e=JSON.parse(localStorage._github_pullrequests);if(!e)return;o.config.username=e.username,o.config.token=e.token}catch(t){}}var o=this;o.displayMessage=!1,o.config={username:"",token:""},o.save=function(){e.defaults.headers.common.Authorization="TOKEN "+o.config.token,e.get("https://api.github.com/user").then(function(e){o.config.username=e.data.login,chrome.runtime.sendMessage({config:o.config},function(e){t(function(){o.displayMessage=!0}),t(function(){o.displayMessage=!1},3e3)})})},n()}function PullRequestFactory(e){function t(t){var n=this;n.title="",n.number=0,n.createdAt="",n.url="",n.repository={id:"",name:""},n.openedBy={name:"",avatar:""},e.get(t.pull_request.url).then(function(e){var t=e.data;n.title=t.title,n.repository.name=t.head.repo.name,n.repository.id=t.head.repo.id,n.openedBy.name=t.user.login,n.openedBy.avatar=t.user.avatar_url,n.number="#"+t.number,n.url=t.html_url;var o=moment(),r=moment(t.created_at);n.createdAt=moment.duration(o.diff(r)).humanize()+" ago"})}return t.load=function(e){return new t(e)},t}function Repositories(){return{}}angular.module("app",["ngAnimate"]),MainController.$inject=["$q","$scope","$timeout","$window","$http","PullRequest"],angular.module("app").controller("Main",MainController),chrome&&chrome.runtime&&chrome.runtime.onMessage&&chrome.runtime.onMessage.addListener(function(e,t,n){e.config&&(localStorage._github_pullrequests=JSON.stringify(e.config)),chrome.browserAction.setBadgeText({text:"?"})}),Options.$inject=["$http","$timeout"],angular.module("app").controller("Options",Options),PullRequestFactory.$inject=["$http"],angular.module("app").factory("PullRequest",PullRequestFactory),angular.module("app").factory("Repositories",Repositories);