function MainController(e,t,o,n,r,a){function u(){if(m.data.pullRequests){var e=_.chain(m.data.pullRequests).groupBy(function(e){return e.repository.name}).value();m.data.grouped=e}}function i(){return e(function(e,t){try{var o=JSON.parse(localStorage._github_pullrequests);o||t(),m.config.username=o.username,m.config.token=o.token,m.config.ok=!0,e(m.config)}catch(n){t()}})}function c(){i().then(l,s)}function s(){m.config.ok=!1,chrome&&chrome.browserAction&&chrome.browserAction.setBadgeText({text:"?"})}function l(e){var t="https://api.github.com/search/issues?q=assignee:"+e.username+"+state:open+type:pr";r.defaults.headers.common.Authorization="TOKEN "+e.token,r.get(t).then(function(e){if(count=e.data.total_count,chrome&&chrome.browserAction){var t=count>0?count.toString():"";chrome.browserAction.setBadgeText({text:t});var o="#4CAF50";4>t&&(o="#4CAF50"),t>=4&&(o="#FF9800"),t>=9&&(o="#F44336"),chrome.browserAction.setBadgeBackgroundColor({color:o})}else m.count=count;m.data.pullRequests=e.data.items.map(a.load)}),g&&o.cancel(g),g=o(function(){l(m.config)},6e4)}var m=this;m.count=0,m.data={pullRequests:[],grouped:[]},m.openPull=function(e){chrome&&chrome.tabs?chrome.tabs.create({url:e.url}):n.location=e.url},t.$watch(function(){return m.data.pullRequests},function(){u()},!0),m.config={ok:!1,username:"",token:""};var g;c(),chrome&&chrome.runtime&&chrome.runtime.onMessage&&chrome.runtime.onMessage.addListener(function(e,t,n){e.config&&(localStorage._github_pullrequests=JSON.stringify(e.config),o(function(){c()}))})}function Options(e,t){function o(){try{var e=JSON.parse(localStorage._github_pullrequests);if(!e)return;n.config.username=e.username,n.config.token=e.token}catch(t){}}var n=this;n.displayMessage=!1,n.config={username:"",token:""},n.save=function(){e.defaults.headers.common.Authorization="TOKEN "+n.config.token,e.get("https://api.github.com/user").then(function(e){n.config.username=e.data.login,chrome.runtime.sendMessage({config:n.config},function(e){t(function(){n.displayMessage=!0}),t(function(){n.displayMessage=!1},3e3)})})},o()}function PullRequestFactory(e){function t(t){var o=this;o.title="",o.number=0,o.createdAt="",o.url="",o.repository={id:"",name:""},o.openedBy={name:"",avatar:""},e.get(t.pull_request.url).then(function(e){var t=e.data;o.title=t.title,o.repository.name=t.head.repo.name,o.repository.id=t.head.repo.id,o.openedBy.name=t.user.login,o.openedBy.avatar=t.user.avatar_url,o.number="#"+t.number,o.url=t.html_url;var n=moment(),r=moment(t.created_at);o.createdAt=moment.duration(n.diff(r)).humanize()+" ago"})}return t.load=function(e){return new t(e)},t}function Repositories(){return{}}angular.module("app",["ngAnimate"]),MainController.$inject=["$q","$scope","$timeout","$window","$http","PullRequest"],angular.module("app").controller("Main",MainController),chrome&&chrome.runtime&&chrome.runtime.onMessage&&chrome.runtime.onMessage.addListener(function(e,t,o){e.config&&(localStorage._github_pullrequests=JSON.stringify(e.config)),chrome.browserAction.setBadgeText({text:"?"})}),Options.$inject=["$http","$timeout"],angular.module("app").controller("Options",Options),PullRequestFactory.$inject=["$http"],angular.module("app").factory("PullRequest",PullRequestFactory),angular.module("app").factory("Repositories",Repositories);